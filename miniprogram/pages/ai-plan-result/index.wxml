<view class="container">
  <!-- ä¸Šéƒ¨ï¼šåœ°å›¾åŒºåŸŸ -->
  <view
    class="map-section {{isItineraryDragging ? 'map-section-dragging' : ''}}"
    style="height: {{mapSectionHeightPx}}px;"
  >
    <map
      id="routeMap"
      latitude="{{latitude}}"
      longitude="{{longitude}}"
      scale="{{scale}}"
      markers="{{markers}}"
      polyline="{{polylines}}"
      include-points="{{includePoints}}"
      show-location
      show-scale
      show-compass
      enable-zoom
      enable-scroll
      bindmarkertap="onMarkerTap"
      style="width: 100%; height: 100%;"
    ></map>
    
    <!-- å›¾ä¾‹ -->
    <view class="map-legend {{isLegendCollapsed ? 'map-legend-collapsed' : ''}}">
      <view class="legend-title-row" bindtap="toggleLegendCollapse">
        <view class="legend-title">ğŸ“Œ è·¯çº¿å›¾ä¾‹</view>
        <view class="legend-toggle">{{isLegendCollapsed ? 'å±•å¼€' : 'æ”¶èµ·'}}</view>
      </view>
      <view class="legend-items" wx:if="{{!isLegendCollapsed}}">
        <view class="legend-item" wx:for="{{dayColors}}" wx:key="index">
          <view class="legend-color" style="background-color: {{item}};"></view>
          <text class="legend-text">ç¬¬{{index + 1}}å¤©</text>
        </view>
      </view>
      <view class="route-mode-panel" wx:if="{{!isLegendCollapsed}}">
        <view class="route-mode-title">å¯¼èˆªæ–¹å¼</view>
        <view class="route-mode-list">
          <view
            class="route-mode-chip {{routeMode === item.mode ? 'route-mode-chip-active' : ''}}"
            wx:for="{{routeModeOptions}}"
            wx:key="mode"
            data-mode="{{item.mode}}"
            bindtap="onRouteModeChange"
          >
            {{item.label}}
          </view>
        </view>
        <view class="route-loading" wx:if="{{isRouteLoading}}">è·¯çº¿è®¡ç®—ä¸­...</view>
      </view>
    </view>
  </view>

  <!-- ä¸‹éƒ¨ï¼šè¡Œç¨‹è§„åˆ’ -->
  <view class="itinerary-section">
    <view
      class="itinerary-drag-zone"
      catchtouchstart="onItineraryTouchStart"
      catchtouchmove="onItineraryTouchMove"
      catchtouchend="onItineraryTouchEnd"
      catchtouchcancel="onItineraryTouchEnd"
      bindtap="toggleItineraryCollapse"
    >
      <view class="itinerary-drag-handle"></view>
    </view>
    <view class="itinerary-header">
      <view class="days-summary">{{days}}å¤©è¡Œç¨‹ Â· {{preferencesText}}</view>
      <view class="itinerary-header-row">
        <view class="route-title">ğŸ—ºï¸ ç‚¹å‡»å›¾é’‰æŸ¥çœ‹æ™¯ç‚¹è¯¦æƒ…</view>
        <view class="itinerary-toggle" bindtap="toggleItineraryCollapse">
          {{isItineraryCollapsed ? 'å±•å¼€è¡Œç¨‹' : 'æ”¶èµ·è¡Œç¨‹'}}
        </view>
      </view>
    </view>

    <view class="timeline">
      <block wx:for="{{itinerary}}" wx:key="index" wx:for-index="dayIndex">
        <view class="day-item">
          <view class="day-title" style="border-left-color: {{dayColors[dayIndex]}};">
            <text class="day-number">ç¬¬{{item.day}}å¤©</text>
          </view>
          
          <view class="spots-list">
            <view class="spot-item" wx:for="{{item.spots}}" wx:key="name" wx:for-index="spotIndex">
              <!-- å…³é”®ä¿®å¤ï¼šç¡®ä¿ç‚¹æœ‰æ­£ç¡®çš„é¢œè‰²å’Œæ ·å¼ -->
              <view class="spot-dot" style="background-color: {{dayColors[dayIndex]}}; width: 16rpx; height: 16rpx; border-radius: 50%; margin-top: 8rpx; margin-right: 20rpx; flex-shrink: 0;"></view>
              <view class="spot-content">
                <view class="spot-name">{{item.name}}</view>
                <view class="spot-desc">{{item.description}}</view>
                <view class="spot-meta">
                  <text class="time">ğŸ•’å»ºè®®æ¸¸ç©æ—¶é—´ï¼š {{item.duration}}</text>
                  <text class="transport"> å»ºè®®äº¤é€šæ–¹å¼ï¼š{{item.transport}}</text>
                </view>
                <view class="spot-tip" wx:if="{{item.tip}}">ğŸ’¡ {{item.tip}}</view>
              </view>
            </view>
          </view>
        </view>
      </block>
    </view>
  </view>
</view>